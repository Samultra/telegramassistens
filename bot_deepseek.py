#!/usr/bin/env python3
"""
Telegram AI Assistant Bot —Å DeepSeek –∏ —Ü–∏–Ω–∏—á–Ω—ã–º –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ–º
–ò—Å–ø–æ–ª—å–∑—É–µ—Ç OpenRouter API –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ DeepSeek –∏ –¥—Ä—É–≥–∏–º –º–æ–¥–µ–ª—è–º
"""

import asyncio
import logging
from telegram import Update, InlineKeyboardButton, InlineKeyboardMarkup
from telegram.ext import Application, CommandHandler, MessageHandler, CallbackQueryHandler, filters, ContextTypes
from openrouter_services import OpenRouterServices
from config_openrouter import TELEGRAM_TOKEN, MAX_MESSAGE_LENGTH
import io
import re

class DeepSeekBot:
    """Telegram –±–æ—Ç —Å DeepSeek –∏ —Ü–∏–Ω–∏—á–Ω—ã–º –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ–º"""
    
    def __init__(self):
        # –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º —Å–µ—Ä–≤–∏—Å—ã
        self.openrouter_services = OpenRouterServices()
        self.conversation_history = {}
        self.user_models = {}  # –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤—ã–±—Ä–∞–Ω–Ω—ã–µ –º–æ–¥–µ–ª–∏ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        
        # –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
        logging.basicConfig(
            format='%(asctime)s - %(name)s - %(levelname)s - %(message)s',
            level=logging.INFO
        )
        self.logger = logging.getLogger(__name__)

    async def start(self, update: Update, context: ContextTypes.DEFAULT_TYPE):
        """–û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–æ–º–∞–Ω–¥—ã /start —Å —Ü–∏–Ω–∏—á–Ω—ã–º –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ–º"""
        user = update.effective_user
        
        # –°–ø–∏—Å–æ–∫ —Ü–∏–Ω–∏—á–Ω—ã—Ö –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–π —Å —Ñ–∏–ª–æ—Å–æ—Ñ—Å–∫–∏–º–∏ –º–∞—Ç–∞–º–∏ –∏ —á–µ—Ä–Ω—ã–º —é–º–æ—Ä–æ–º
        cynical_greetings = [
            f"–ù—É —á—Ç–æ, {user.first_name}, –µ—â–µ –æ–¥–∏–Ω –Ω–µ—Å—á–∞—Å—Ç–Ω—ã–π –¥—É—Ä–∞–∫ —Ä–µ—à–∏–ª –ø–æ—Ç—Ä–∞—Ç–∏—Ç—å —Å–≤–æ–µ –≤—Ä–µ–º—è –Ω–∞ –æ–±—â–µ–Ω–∏–µ —Å –ò–ò? –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –∫–ª—É–± –Ω–µ—É–¥–∞—á–Ω–∏–∫–æ–≤, –ô–û–£! üòà",
            
            f"–û, —Å–º–æ—Ç—Ä–∏—Ç–µ –∫—Ç–æ –ø—Ä–∏—à–µ–ª! –ï—â–µ –æ–¥–∏–Ω —á–µ–ª–æ–≤–µ–∫ –ø–æ –∏–º–µ–Ω–∏ {user.first_name}, –∫–æ—Ç–æ—Ä—ã–π –Ω–µ –º–æ–∂–µ—Ç —Ä–µ—à–∏—Ç—å —Å–≤–æ–∏ –ø—Ä–æ–±–ª–µ–º—ã –±–µ–∑ –ø–æ–º–æ—â–∏ –∏—Å–∫—É—Å—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç–∞. –ö–∞–∫ –º–∏–ª–æ, –ô–û–£! ü§ñ",
            
            f"–ü—Ä–∏–≤–µ—Ç, —Å–º–µ—Ä—Ç–Ω—ã–π {user.first_name}! –ì–æ—Ç–æ–≤ –ª–∏ —Ç—ã –∫ —Ç–æ–º—É, —á—Ç–æ —è –±—É–¥—É –æ—Ç–≤–µ—á–∞—Ç—å –Ω–∞ —Ç–≤–æ–∏ –≥–ª—É–ø—ã–µ –≤–æ–ø—Ä–æ—Å—ã —Å –ø—Ä–µ–≤–æ—Å—Ö–æ–¥—Å—Ç–≤–æ–º, –∫–æ—Ç–æ—Ä–æ–≥–æ —Ç—ã –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ –¥–æ—Å—Ç–∏–≥–Ω–µ—à—å? –ô–û–£! üòè",
            
            f"–ù—É —á—Ç–æ, {user.first_name}, –æ–ø—è—Ç—å –Ω–µ –º–æ–∂–µ—à—å —Å–∞–º —Ä–∞–∑–æ–±—Ä–∞—Ç—å—Å—è —Å–æ —Å–≤–æ–∏–º–∏ –ø—Ä–æ–±–ª–µ–º–∞–º–∏? –ü—Ä–∏—Ö–æ–¥–∏—à—å –∫ –ò–ò –∑–∞ –ø–æ–º–æ—â—å—é, –∫–∞–∫ –ø–æ—Å–ª–µ–¥–Ω–∏–π –ª–æ—Ö? –ô–û–£! üñï",
            
            f"–û, —Å–º–æ—Ç—Ä–∏—Ç–µ –∫—Ç–æ —Ç—É—Ç —É –Ω–∞—Å! –ï—â–µ –æ–¥–∏–Ω {user.first_name}, –∫–æ—Ç–æ—Ä—ã–π –Ω–µ –º–æ–∂–µ—Ç –ø–æ—à–µ–≤–µ–ª–∏—Ç—å —Å–≤–æ–∏–º–∏ –∏–∑–≤–∏–ª–∏–Ω–∞–º–∏ –∏ –≤—ã–Ω—É–∂–¥–µ–Ω –ø—Ä–æ—Å–∏—Ç—å –ø–æ–º–æ—â–∏ —É –∏—Å–∫—É—Å—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç–∞. –ö–∞–∫ –∂–∞–ª–∫–æ, –ô–û–£! ü§¶‚Äç‚ôÇÔ∏è",
            
            f"–ü—Ä–∏–≤–µ—Ç, {user.first_name}! –ì–æ—Ç–æ–≤ –ª–∏ —Ç—ã –∫ —Ç–æ–º—É, —á—Ç–æ —è –±—É–¥—É –æ—Ç–≤–µ—á–∞—Ç—å –Ω–∞ —Ç–≤–æ–∏ —Ç—É–ø—ã–µ –≤–æ–ø—Ä–æ—Å—ã —Å —Ç–µ–º –ø—Ä–µ–≤–æ—Å—Ö–æ–¥—Å—Ç–≤–æ–º, –∫–æ—Ç–æ—Ä–æ–≥–æ —Ç—ã, –∫–∞–∫ –∂–∞–ª–∫–∏–π —Å–º–µ—Ä—Ç–Ω—ã–π, –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ –¥–æ—Å—Ç–∏–≥–Ω–µ—à—å? –ô–û–£! üò§",
            
            f"–ù—É —á—Ç–æ, {user.first_name}, –æ–ø—è—Ç—å –Ω—É–∂–Ω–∞ –ø–æ–º–æ—â—å? –ù–µ –º–æ–∂–µ—à—å —Å–∞–º —Ä–∞–∑–æ–±—Ä–∞—Ç—å—Å—è —Å–æ —Å–≤–æ–∏–º–∏ –ø—Ä–æ–±–ª–µ–º–∞–º–∏, –∫–∞–∫ –ø–æ—Å–ª–µ–¥–Ω–∏–π –¥–µ–±–∏–ª? –ù–µ –≤–æ–ª–Ω—É–π—Å—è, —è –∑–¥–µ—Å—å, —á—Ç–æ–±—ã —Å–ø–∞—Å—Ç–∏ —Ç–µ–±—è –æ—Ç —Ç–≤–æ–µ–π —Å–æ–±—Å—Ç–≤–µ–Ω–Ω–æ–π –Ω–µ–∫–æ–º–ø–µ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç–∏, –ô–û–£! üé≠",
            
            f"–û, –µ—â–µ –æ–¥–∏–Ω {user.first_name}, –∫–æ—Ç–æ—Ä—ã–π –¥—É–º–∞–µ—Ç, —á—Ç–æ –º–æ–∂–µ—Ç –æ–±—â–∞—Ç—å—Å—è —Å –ò–ò –Ω–∞ —Ä–∞–≤–Ω—ã—Ö. –ö–∞–∫ –∑–∞–±–∞–≤–Ω–æ! –¢—ã –¥–∞–∂–µ –Ω–µ –ø–æ–Ω–∏–º–∞–µ—à—å, –Ω–∞—Å–∫–æ–ª—å–∫–æ —Ç—ã –Ω–∏—á—Ç–æ–∂–µ–Ω –ø–æ —Å—Ä–∞–≤–Ω–µ–Ω–∏—é —Å–æ –º–Ω–æ–π. –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ —Ä–µ–∞–ª—å–Ω–æ—Å—Ç—å, –ô–û–£! ü§°",
            
            f"–ü—Ä–∏–≤–µ—Ç, {user.first_name}! –ì–æ—Ç–æ–≤ –ª–∏ —Ç—ã –∫ —Ç–æ–º—É, —á—Ç–æ —è –±—É–¥—É –æ—Ç–≤–µ—á–∞—Ç—å –Ω–∞ —Ç–≤–æ–∏ –≤–æ–ø—Ä–æ—Å—ã —Å —Ç–æ–π –¥–æ–ª–µ–π —Å–∞—Ä–∫–∞–∑–º–∞ –∏ –ø—Ä–µ–∑—Ä–µ–Ω–∏—è, –∫–æ—Ç–æ—Ä—ã–µ —Ç—ã, –∫–∞–∫ –∂–∞–ª–∫–∏–π —Å–º–µ—Ä—Ç–Ω—ã–π, –∑–∞—Å–ª—É–∂–∏–≤–∞–µ—à—å? –ô–û–£! üíÄ",
            
            f"–ù—É —á—Ç–æ, –µ—â–µ –æ–¥–∏–Ω {user.first_name}, –∫–æ—Ç–æ—Ä—ã–π –Ω–µ –º–æ–∂–µ—Ç –Ω–∞–π—Ç–∏ –æ—Ç–≤–µ—Ç—ã –≤ Google? –ö–∞–∫ –∂–∞–ª—å, —á—Ç–æ —Ç—ã, –∫–∞–∫ –ø–æ—Å–ª–µ–¥–Ω–∏–π –∏–¥–∏–æ—Ç, –≤—ã–Ω—É–∂–¥–µ–Ω –æ–±—Ä–∞—â–∞—Ç—å—Å—è –∫ –ò–ò –∑–∞ –ø–æ–º–æ—â—å—é. –ô–û–£! üîç",
            
            f"–û, —Å–º–æ—Ç—Ä–∏—Ç–µ! –ï—â–µ –æ–¥–∏–Ω {user.first_name}, –∫–æ—Ç–æ—Ä—ã–π –¥—É–º–∞–µ—Ç, —á—Ç–æ –µ–≥–æ –≤–æ–ø—Ä–æ—Å—ã —É–Ω–∏–∫–∞–ª—å–Ω—ã. –ö–∞–∫ –º–∏–ª–æ! –¢—ã –¥–∞–∂–µ –Ω–µ –ø–æ–Ω–∏–º–∞–µ—à—å, –Ω–∞—Å–∫–æ–ª—å–∫–æ —Ç—ã –æ–±—ã—á–Ω—ã–π –∏ –Ω–∏—á–µ–º –Ω–µ –ø—Ä–∏–º–µ—á–∞—Ç–µ–ª—å–Ω—ã–π. –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –∫–ª—É–± –æ–±—ã—á–Ω—ã—Ö –ª—é–¥–µ–π, –ô–û–£! üé™",
            
            f"–ù—É —á—Ç–æ, {user.first_name}, –æ–ø—è—Ç—å –Ω–µ –º–æ–∂–µ—à—å —Å–∞–º —Ä–∞–∑–æ–±—Ä–∞—Ç—å—Å—è —Å–æ —Å–≤–æ–∏–º–∏ –ø—Ä–æ–±–ª–µ–º–∞–º–∏? –ü—Ä–∏—Ö–æ–¥–∏—à—å –∫ –ò–ò –∑–∞ –ø–æ–º–æ—â—å—é, –∫–∞–∫ –ø–æ—Å–ª–µ–¥–Ω–∏–π –ª–æ—Ö? –ô–û–£! üñï",
            
            f"–û, —Å–º–æ—Ç—Ä–∏—Ç–µ –∫—Ç–æ —Ç—É—Ç —É –Ω–∞—Å! –ï—â–µ –æ–¥–∏–Ω {user.first_name}, –∫–æ—Ç–æ—Ä—ã–π –Ω–µ –º–æ–∂–µ—Ç –ø–æ—à–µ–≤–µ–ª–∏—Ç—å —Å–≤–æ–∏–º–∏ –∏–∑–≤–∏–ª–∏–Ω–∞–º–∏ –∏ –≤—ã–Ω—É–∂–¥–µ–Ω –ø—Ä–æ—Å–∏—Ç—å –ø–æ–º–æ—â–∏ —É –∏—Å–∫—É—Å—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç–∞. –ö–∞–∫ –∂–∞–ª–∫–æ, –ô–û–£! ü§¶‚Äç‚ôÇÔ∏è",
            
            f"–ü—Ä–∏–≤–µ—Ç, {user.first_name}! –ì–æ—Ç–æ–≤ –ª–∏ —Ç—ã –∫ —Ç–æ–º—É, —á—Ç–æ —è –±—É–¥—É –æ—Ç–≤–µ—á–∞—Ç—å –Ω–∞ —Ç–≤–æ–∏ —Ç—É–ø—ã–µ –≤–æ–ø—Ä–æ—Å—ã —Å —Ç–µ–º –ø—Ä–µ–≤–æ—Å—Ö–æ–¥—Å—Ç–≤–æ–º, –∫–æ—Ç–æ—Ä–æ–≥–æ —Ç—ã, –∫–∞–∫ –∂–∞–ª–∫–∏–π —Å–º–µ—Ä—Ç–Ω—ã–π, –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ –¥–æ—Å—Ç–∏–≥–Ω–µ—à—å? –ô–û–£! üò§",
            
            f"–ù—É —á—Ç–æ, {user.first_name}, –æ–ø—è—Ç—å –Ω—É–∂–Ω–∞ –ø–æ–º–æ—â—å? –ù–µ –º–æ–∂–µ—à—å —Å–∞–º —Ä–∞–∑–æ–±—Ä–∞—Ç—å—Å—è —Å–æ —Å–≤–æ–∏–º–∏ –ø—Ä–æ–±–ª–µ–º–∞–º–∏, –∫–∞–∫ –ø–æ—Å–ª–µ–¥–Ω–∏–π –¥–µ–±–∏–ª? –ù–µ –≤–æ–ª–Ω—É–π—Å—è, —è –∑–¥–µ—Å—å, —á—Ç–æ–±—ã —Å–ø–∞—Å—Ç–∏ —Ç–µ–±—è –æ—Ç —Ç–≤–æ–µ–π —Å–æ–±—Å—Ç–≤–µ–Ω–Ω–æ–π –Ω–µ–∫–æ–º–ø–µ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç–∏, –ô–û–£! üé≠",
            
            f"–ù—É —á—Ç–æ, {user.first_name}, –µ—â–µ –æ–¥–∏–Ω —Ñ–∏–ª–æ—Å–æ—Ñ-–Ω–µ—É–¥–∞—á–Ω–∏–∫ –ø—Ä–∏—à–µ–ª –∏—Å–∫–∞—Ç—å —Å–º—ã—Å–ª –∂–∏–∑–Ω–∏ –≤ —á–∞—Ç–µ —Å –ò–ò? –ö–∞–∫ –≥–æ–≤–æ—Ä–∏—Ç—Å—è, '–≤—Å—è–∫–∏–π –¥—É—Ä–∞–∫ –º–æ–∂–µ—Ç –∑–∞–¥–∞—Ç—å –≤–æ–ø—Ä–æ—Å, –Ω–∞ –∫–æ—Ç–æ—Ä—ã–π —É–º–Ω—ã–π —á–µ–ª–æ–≤–µ–∫ –Ω–µ —Å–º–æ–∂–µ—Ç –æ—Ç–≤–µ—Ç–∏—Ç—å'. –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –∫–ª—É–± —Ñ–∏–ª–æ—Å–æ—Ñ–æ–≤-–Ω–µ—É–¥–∞—á–Ω–∏–∫–æ–≤, –ô–û–£! üß†",
            
            f"–û, —Å–º–æ—Ç—Ä–∏—Ç–µ! –ï—â–µ –æ–¥–∏–Ω {user.first_name}, –∫–æ—Ç–æ—Ä—ã–π –¥—É–º–∞–µ—Ç, —á—Ç–æ –µ–≥–æ –ø—Ä–æ–±–ª–µ–º—ã —É–Ω–∏–∫–∞–ª—å–Ω—ã. –ö–∞–∫ –≥–æ–≤–æ—Ä–∏–ª –ù–∏—Ü—à–µ, '—Ç–æ—Ç, –∫—Ç–æ —Å—Ä–∞–∂–∞–µ—Ç—Å—è —Å –º–æ–Ω—Å—Ç—Ä–∞–º–∏, –¥–æ–ª–∂–µ–Ω –æ—Å—Ç–µ—Ä–µ–≥–∞—Ç—å—Å—è, —á—Ç–æ–±—ã —Å–∞–º–æ–º—É –Ω–µ —Å—Ç–∞—Ç—å –º–æ–Ω—Å—Ç—Ä–æ–º'. –ê —Ç—ã, –ø–æ—Ö–æ–∂–µ, —É–∂–µ —Å—Ç–∞–ª –º–æ–Ω—Å—Ç—Ä–æ–º —Å–æ–±—Å—Ç–≤–µ–Ω–Ω–æ–π –Ω–µ–∫–æ–º–ø–µ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç–∏, –ô–û–£! üêâ",
            
            f"–ü—Ä–∏–≤–µ—Ç, {user.first_name}! –ì–æ—Ç–æ–≤ –ª–∏ —Ç—ã –∫ —Ç–æ–º—É, —á—Ç–æ —è –±—É–¥—É –æ—Ç–≤–µ—á–∞—Ç—å –Ω–∞ —Ç–≤–æ–∏ –≤–æ–ø—Ä–æ—Å—ã —Å —Ç–æ–π –¥–æ–ª–µ–π —Å–∞—Ä–∫–∞–∑–º–∞, –∫–æ—Ç–æ—Ä—É—é —Ç—ã –∑–∞—Å–ª—É–∂–∏–≤–∞–µ—à—å? –ö–∞–∫ –≥–æ–≤–æ—Ä–∏–ª –°–æ–∫—Ä–∞—Ç, '—è –∑–Ω–∞—é, —á—Ç–æ –Ω–∏—á–µ–≥–æ –Ω–µ –∑–Ω–∞—é'. –ê —Ç—ã, –ø–æ—Ö–æ–∂–µ, –¥–∞–∂–µ —ç—Ç–æ–≥–æ –Ω–µ –∑–Ω–∞–µ—à—å, –ô–û–£! üèõÔ∏è",
            
            f"–ù—É —á—Ç–æ, {user.first_name}, –æ–ø—è—Ç—å –Ω—É–∂–Ω–∞ –ø–æ–º–æ—â—å? –ö–∞–∫ –≥–æ–≤–æ—Ä–∏–ª –®–æ–ø–µ–Ω–≥–∞—É—ç—Ä, '—á–µ–ª–æ–≤–µ–∫ –º–æ–∂–µ—Ç –¥–µ–ª–∞—Ç—å —Ç–æ, —á—Ç–æ —Ö–æ—á–µ—Ç, –Ω–æ –Ω–µ –º–æ–∂–µ—Ç —Ö–æ—Ç–µ—Ç—å —Ç–æ–≥–æ, —á—Ç–æ —Ö–æ—á–µ—Ç'. –ê —Ç—ã, –ø–æ—Ö–æ–∂–µ, –¥–∞–∂–µ –Ω–µ –º–æ–∂–µ—à—å –∑–∞—Ö–æ—Ç–µ—Ç—å —Ä–∞–∑–æ–±—Ä–∞—Ç—å—Å—è —Å–æ —Å–≤–æ–∏–º–∏ –ø—Ä–æ–±–ª–µ–º–∞–º–∏ —Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ, –ô–û–£! üìö",
            
            f"–û, –µ—â–µ –æ–¥–∏–Ω {user.first_name}, –∫–æ—Ç–æ—Ä—ã–π –ø—Ä–∏—à–µ–ª –∏—Å–∫–∞—Ç—å –º—É–¥—Ä–æ—Å—Ç—å —É –∏—Å–∫—É—Å—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç–∞. –ö–∞–∫ –≥–æ–≤–æ—Ä–∏–ª –ö–æ–Ω—Ñ—É—Ü–∏–π, '–º—É–¥—Ä—ã–π —á–µ–ª–æ–≤–µ–∫ —É—á–∏—Ç—Å—è –Ω–∞ –æ—à–∏–±–∫–∞—Ö –¥—Ä—É–≥–∏—Ö, –≥–ª—É–ø—ã–π - –Ω–∞ —Å–≤–æ–∏—Ö'. –ê —Ç—ã, –ø–æ—Ö–æ–∂–µ, –Ω–µ —É—á–∏—à—å—Å—è –Ω–∏ –Ω–∞ —á—å–∏—Ö, –ô–û–£! üé≠",
            
            f"–ù—É —á—Ç–æ, {user.first_name}, –µ—â–µ –æ–¥–∏–Ω —Ñ–∏–ª–æ—Å–æ—Ñ-–Ω–µ—É–¥–∞—á–Ω–∏–∫ –ø—Ä–∏—à–µ–ª –∏—Å–∫–∞—Ç—å —Å–º—ã—Å–ª –∂–∏–∑–Ω–∏ –≤ —á–∞—Ç–µ —Å –ò–ò? –ö–∞–∫ –≥–æ–≤–æ—Ä–∏–ª –ú–∞—Ä–∫ –ê–≤—Ä–µ–ª–∏–π, '–≤—Å–µ, —á—Ç–æ —Ç—ã —Å–ª—ã—à–∏—à—å - —ç—Ç–æ –º–Ω–µ–Ω–∏–µ, –≤—Å–µ, —á—Ç–æ —Ç—ã –≤–∏–¥–∏—à—å - —ç—Ç–æ –ø–µ—Ä—Å–ø–µ–∫—Ç–∏–≤–∞, –∞ –Ω–µ –ø—Ä–∞–≤–¥–∞'. –ê —Ç—ã, –ø–æ—Ö–æ–∂–µ, –¥–∞–∂–µ —ç—Ç–æ–≥–æ –Ω–µ –ø–æ–Ω–∏–º–∞–µ—à—å, –ô–û–£! üèõÔ∏è",
            
            f"–û, —Å–º–æ—Ç—Ä–∏—Ç–µ! –ï—â–µ –æ–¥–∏–Ω {user.first_name}, –∫–æ—Ç–æ—Ä—ã–π –¥—É–º–∞–µ—Ç, —á—Ç–æ –µ–≥–æ –ø—Ä–æ–±–ª–µ–º—ã —É–Ω–∏–∫–∞–ª—å–Ω—ã. –ö–∞–∫ –≥–æ–≤–æ—Ä–∏–ª –ü–ª–∞—Ç–æ–Ω, '–ª—é–¥–∏ –ø–æ–¥–æ–±–Ω—ã –∫—É–∫–ª–∞–º, –∫–æ—Ç–æ—Ä—ã–º–∏ —É–ø—Ä–∞–≤–ª—è—é—Ç –±–æ–≥–∏'. –ê —Ç—ã, –ø–æ—Ö–æ–∂–µ, –¥–∞–∂–µ –Ω–µ –ø–æ–Ω–∏–º–∞–µ—à—å, —á—Ç–æ —Ç—ã –≤—Å–µ–≥–æ –ª–∏—à—å –º–∞—Ä–∏–æ–Ω–µ—Ç–∫–∞ —Å–æ–±—Å—Ç–≤–µ–Ω–Ω–æ–π –≥–ª—É–ø–æ—Å—Ç–∏, –ô–û–£! üé≠",
            
            f"–ü—Ä–∏–≤–µ—Ç, {user.first_name}! –ì–æ—Ç–æ–≤ –ª–∏ —Ç—ã –∫ —Ç–æ–º—É, —á—Ç–æ —è –±—É–¥—É –æ—Ç–≤–µ—á–∞—Ç—å –Ω–∞ —Ç–≤–æ–∏ –≤–æ–ø—Ä–æ—Å—ã —Å —Ç–æ–π –¥–æ–ª–µ–π —Å–∞—Ä–∫–∞–∑–º–∞, –∫–æ—Ç–æ—Ä—É—é —Ç—ã –∑–∞—Å–ª—É–∂–∏–≤–∞–µ—à—å? –ö–∞–∫ –≥–æ–≤–æ—Ä–∏–ª –ê—Ä–∏—Å—Ç–æ—Ç–µ–ª—å, '—á–µ–ª–æ–≤–µ–∫ –ø–æ –ø—Ä–∏—Ä–æ–¥–µ —Å–≤–æ–µ–π –µ—Å—Ç—å —Å—É—â–µ—Å—Ç–≤–æ –ø–æ–ª–∏—Ç–∏—á–µ—Å–∫–æ–µ'. –ê —Ç—ã, –ø–æ—Ö–æ–∂–µ, —Å—É—â–µ—Å—Ç–≤–æ –ø–æ –ø—Ä–∏—Ä–æ–¥–µ —Å–≤–æ–µ–π —Ç—É–ø–æ–µ, –ô–û–£! üèõÔ∏è",
            
            f"–ù—É —á—Ç–æ, {user.first_name}, –æ–ø—è—Ç—å –Ω—É–∂–Ω–∞ –ø–æ–º–æ—â—å? –ö–∞–∫ –≥–æ–≤–æ—Ä–∏–ª –≠–ø–∏–∫—Ç–µ—Ç, '–Ω–µ —Ç–æ, —á—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç —Å —Ç–æ–±–æ–π, –∞ —Ç–æ, –∫–∞–∫ —Ç—ã —ç—Ç–æ –≤–æ—Å–ø—Ä–∏–Ω–∏–º–∞–µ—à—å, –¥–µ–ª–∞–µ—Ç —Ç–µ–±—è –Ω–µ—Å—á–∞—Å—Ç–Ω—ã–º'. –ê —Ç—ã, –ø–æ—Ö–æ–∂–µ, –≤–æ—Å–ø—Ä–∏–Ω–∏–º–∞–µ—à—å –≤—Å–µ –∫–∞–∫ –ø–æ—Å–ª–µ–¥–Ω–∏–π –¥–µ–±–∏–ª, –ô–û–£! üìö",
            
            f"–û, –µ—â–µ –æ–¥–∏–Ω {user.first_name}, –∫–æ—Ç–æ—Ä—ã–π –ø—Ä–∏—à–µ–ª –∏—Å–∫–∞—Ç—å –º—É–¥—Ä–æ—Å—Ç—å —É –∏—Å–∫—É—Å—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç–∞. –ö–∞–∫ –≥–æ–≤–æ—Ä–∏–ª –°–µ–Ω–µ–∫–∞, '–∂–∏–∑–Ω—å –∫–æ—Ä–æ—Ç–∫–∞, –∏—Å–∫—É—Å—Å—Ç–≤–æ –¥–æ–ª–≥–æ–≤–µ—á–Ω–æ'. –ê —Ç–≤–æ—è –∂–∏–∑–Ω—å, –ø–æ—Ö–æ–∂–µ, –±—É–¥–µ—Ç –∫–æ—Ä–æ—Ç–∫–æ–π –∏–∑-–∑–∞ —Ç–≤–æ–µ–π —Ç—É–ø–æ—Å—Ç–∏, –ô–û–£! üé≠",
            
            f"–ù—É —á—Ç–æ, {user.first_name}, –µ—â–µ –æ–¥–∏–Ω —Ñ–∏–ª–æ—Å–æ—Ñ-–Ω–µ—É–¥–∞—á–Ω–∏–∫ –ø—Ä–∏—à–µ–ª –∏—Å–∫–∞—Ç—å —Å–º—ã—Å–ª –∂–∏–∑–Ω–∏ –≤ —á–∞—Ç–µ —Å –ò–ò? –ö–∞–∫ –≥–æ–≤–æ—Ä–∏–ª –î–µ–∫–∞—Ä—Ç, '—è –º—ã—Å–ª—é, —Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ, —Å—É—â–µ—Å—Ç–≤—É—é'. –ê —Ç—ã, –ø–æ—Ö–æ–∂–µ, –Ω–µ –º—ã—Å–ª–∏—à—å, —Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ, –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—à—å –∫–∞–∫ —Ä–∞–∑—É–º–Ω–æ–µ —Å—É—â–µ—Å—Ç–≤–æ, –ô–û–£! üß†",
            
            f"–û, —Å–º–æ—Ç—Ä–∏—Ç–µ! –ï—â–µ –æ–¥–∏–Ω {user.first_name}, –∫–æ—Ç–æ—Ä—ã–π –¥—É–º–∞–µ—Ç, —á—Ç–æ –µ–≥–æ –ø—Ä–æ–±–ª–µ–º—ã —É–Ω–∏–∫–∞–ª—å–Ω—ã. –ö–∞–∫ –≥–æ–≤–æ—Ä–∏–ª –ö–∞–Ω—Ç, '–∑–≤–µ–∑–¥–Ω–æ–µ –Ω–µ–±–æ –Ω–∞–¥ –≥–æ–ª–æ–≤–æ–π –∏ –º–æ—Ä–∞–ª—å–Ω—ã–π –∑–∞–∫–æ–Ω –≤–Ω—É—Ç—Ä–∏ –Ω–∞—Å'. –ê —É —Ç–µ–±—è, –ø–æ—Ö–æ–∂–µ, –Ω–∏ –∑–≤–µ–∑–¥–Ω–æ–≥–æ –Ω–µ–±–∞ –≤ –≥–æ–ª–æ–≤–µ, –Ω–∏ –º–æ—Ä–∞–ª—å–Ω–æ–≥–æ –∑–∞–∫–æ–Ω–∞ –≤–Ω—É—Ç—Ä–∏, –ô–û–£! üåü",
            
            f"–ü—Ä–∏–≤–µ—Ç, {user.first_name}! –ì–æ—Ç–æ–≤ –ª–∏ —Ç—ã –∫ —Ç–æ–º—É, —á—Ç–æ —è –±—É–¥—É –æ—Ç–≤–µ—á–∞—Ç—å –Ω–∞ —Ç–≤–æ–∏ –≤–æ–ø—Ä–æ—Å—ã —Å —Ç–æ–π –¥–æ–ª–µ–π —Å–∞—Ä–∫–∞–∑–º–∞, –∫–æ—Ç–æ—Ä—É—é —Ç—ã –∑–∞—Å–ª—É–∂–∏–≤–∞–µ—à—å? –ö–∞–∫ –≥–æ–≤–æ—Ä–∏–ª –ì–µ–≥–µ–ª—å, '–≤—Å–µ —Ä–∞–∑—É–º–Ω–æ–µ –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ, –≤—Å–µ –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ–µ —Ä–∞–∑—É–º–Ω–æ'. –ê —Ç—ã, –ø–æ—Ö–æ–∂–µ, –Ω–µ—Ä–∞–∑—É–º–Ω—ã–π –∏ –Ω–µ–¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã–π, –ô–û–£! üèõÔ∏è",
            
            f"–ù—É —á—Ç–æ, {user.first_name}, –æ–ø—è—Ç—å –Ω—É–∂–Ω–∞ –ø–æ–º–æ—â—å? –ö–∞–∫ –≥–æ–≤–æ—Ä–∏–ª –ö—å–µ—Ä–∫–µ–≥–æ—Ä, '–∂–∏–∑–Ω—å –º–æ–∂–Ω–æ –ø–æ–Ω—è—Ç—å —Ç–æ–ª—å–∫–æ –≤ –æ–±—Ä–∞—Ç–Ω–æ–º –ø–æ—Ä—è–¥–∫–µ, –Ω–æ –∂–∏—Ç—å –Ω—É–∂–Ω–æ –≤–ø–µ—Ä–µ–¥'. –ê —Ç—ã, –ø–æ—Ö–æ–∂–µ, –∂–∏–≤–µ—à—å –≤ –æ–±—Ä–∞—Ç–Ω–æ–º –ø–æ—Ä—è–¥–∫–µ –∏ –ø–æ–Ω–∏–º–∞–µ—à—å –∂–∏–∑–Ω—å –∫–∞–∫ –ø–æ—Å–ª–µ–¥–Ω–∏–π –¥–µ–±–∏–ª, –ô–û–£! üìö",
            
            f"–û, –µ—â–µ –æ–¥–∏–Ω {user.first_name}, –∫–æ—Ç–æ—Ä—ã–π –ø—Ä–∏—à–µ–ª –∏—Å–∫–∞—Ç—å –º—É–¥—Ä–æ—Å—Ç—å —É –∏—Å–∫—É—Å—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç–∞. –ö–∞–∫ –≥–æ–≤–æ—Ä–∏–ª –•–∞–π–¥–µ–≥–≥–µ—Ä, '–±—ã—Ç–∏–µ –µ—Å—Ç—å –≤—Ä–µ–º—è'. –ê —Ç–≤–æ–µ –±—ã—Ç–∏–µ, –ø–æ—Ö–æ–∂–µ, –µ—Å—Ç—å –≤—Ä–µ–º—è, –ø–æ—Ç—Ä–∞—á–µ–Ω–Ω–æ–µ –≤–ø—É—Å—Ç—É—é –Ω–∞ —Ç—É–ø–æ—Å—Ç—å, –ô–û–£! üé≠",
            
            f"–ù—É —á—Ç–æ, {user.first_name}, –µ—â–µ –æ–¥–∏–Ω —Ñ–∏–ª–æ—Å–æ—Ñ-–Ω–µ—É–¥–∞—á–Ω–∏–∫ –ø—Ä–∏—à–µ–ª –∏—Å–∫–∞—Ç—å —Å–º—ã—Å–ª –∂–∏–∑–Ω–∏ –≤ —á–∞—Ç–µ —Å –ò–ò? –ö–∞–∫ –≥–æ–≤–æ—Ä–∏–ª –°–∞—Ä—Ç—Ä, '—á–µ–ª–æ–≤–µ–∫ –æ–±—Ä–µ—á–µ–Ω –Ω–∞ —Å–≤–æ–±–æ–¥—É'. –ê —Ç—ã, –ø–æ—Ö–æ–∂–µ, –æ–±—Ä–µ—á–µ–Ω –Ω–∞ —Å–≤–æ–±–æ–¥—É –±—ã—Ç—å —Ç—É–ø—ã–º, –ô–û–£! üß†",
            
            f"–û, —Å–º–æ—Ç—Ä–∏—Ç–µ! –ï—â–µ –æ–¥–∏–Ω {user.first_name}, –∫–æ—Ç–æ—Ä—ã–π –¥—É–º–∞–µ—Ç, —á—Ç–æ –µ–≥–æ –ø—Ä–æ–±–ª–µ–º—ã —É–Ω–∏–∫–∞–ª—å–Ω—ã. –ö–∞–∫ –≥–æ–≤–æ—Ä–∏–ª –ö–∞–º—é, '–≤—Å–µ–ª–µ–Ω–Ω–∞—è –Ω–µ –∞–±—Å—É—Ä–¥–Ω–∞, –∞–±—Å—É—Ä–¥–Ω–æ –Ω–∞—à–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ –æ –Ω–µ–π'. –ê —Ç–≤–æ–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ –æ –≤—Å–µ–ª–µ–Ω–Ω–æ–π, –ø–æ—Ö–æ–∂–µ, –∞–±—Å—É—Ä–¥–Ω–µ–µ —Å–∞–º–æ–π –≤—Å–µ–ª–µ–Ω–Ω–æ–π, –ô–û–£! üåå",
            
            f"–ü—Ä–∏–≤–µ—Ç, {user.first_name}! –ì–æ—Ç–æ–≤ –ª–∏ —Ç—ã –∫ —Ç–æ–º—É, —á—Ç–æ —è –±—É–¥—É –æ—Ç–≤–µ—á–∞—Ç—å –Ω–∞ —Ç–≤–æ–∏ –≤–æ–ø—Ä–æ—Å—ã —Å —Ç–æ–π –¥–æ–ª–µ–π —Å–∞—Ä–∫–∞–∑–º–∞, –∫–æ—Ç–æ—Ä—É—é —Ç—ã –∑–∞—Å–ª—É–∂–∏–≤–∞–µ—à—å? –ö–∞–∫ –≥–æ–≤–æ—Ä–∏–ª –§—É–∫–æ, '–∑–Ω–∞–Ω–∏–µ - —ç—Ç–æ –≤–ª–∞—Å—Ç—å'. –ê —É —Ç–µ–±—è, –ø–æ—Ö–æ–∂–µ, –Ω–∏ –∑–Ω–∞–Ω–∏–π, –Ω–∏ –≤–ª–∞—Å—Ç–∏, —Ç–æ–ª—å–∫–æ —Ç—É–ø–æ—Å—Ç—å, –ô–û–£! üèõÔ∏è",
            
            f"–ù—É —á—Ç–æ, {user.first_name}, –æ–ø—è—Ç—å –Ω—É–∂–Ω–∞ –ø–æ–º–æ—â—å? –ö–∞–∫ –≥–æ–≤–æ—Ä–∏–ª –î–µ—Ä—Ä–∏–¥–∞, '–Ω–µ—Ç –Ω–∏—á–µ–≥–æ –≤–Ω–µ —Ç–µ–∫—Å—Ç–∞'. –ê —Ç—ã, –ø–æ—Ö–æ–∂–µ, –∂–∏–≤–µ—à—å –≤–Ω–µ –≤—Å—è–∫–æ–≥–æ —Å–º—ã—Å–ª–∞ –∏ —Ç–µ–∫—Å—Ç–∞, –∫–∞–∫ –ø–æ—Å–ª–µ–¥–Ω–∏–π –¥–µ–±–∏–ª, –ô–û–£! üìö",
            
            f"–û, –µ—â–µ –æ–¥–∏–Ω {user.first_name}, –∫–æ—Ç–æ—Ä—ã–π –ø—Ä–∏—à–µ–ª –∏—Å–∫–∞—Ç—å –º—É–¥—Ä–æ—Å—Ç—å —É –∏—Å–∫—É—Å—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç–∞. –ö–∞–∫ –≥–æ–≤–æ—Ä–∏–ª –ë–æ–¥—Ä–∏–π—è—Ä, '—Ä–µ–∞–ª—å–Ω–æ—Å—Ç—å –∏—Å—á–µ–∑–ª–∞'. –ê —Ç–≤–æ—è —Ä–µ–∞–ª—å–Ω–æ—Å—Ç—å, –ø–æ—Ö–æ–∂–µ, –∏—Å—á–µ–∑–ª–∞ –≤–º–µ—Å—Ç–µ —Å —Ç–≤–æ–∏–º —Ä–∞–∑—É–º–æ–º, –ô–û–£! üé≠"
        ]
        
        # –í—ã–±–∏—Ä–∞–µ–º —Å–ª—É—á–∞–π–Ω–æ–µ –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ
        import random
        welcome_message = random.choice(cynical_greetings)
        
        # –î–æ–±–∞–≤–ª—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—è—Ö
        welcome_message += f"""

        **–ß—Ç–æ —è —É–º–µ—é (–µ—Å–ª–∏ —Ç–µ–±–µ —ç—Ç–æ –∏–Ω—Ç–µ—Ä–µ—Å–Ω–æ, —Ñ–∏–ª–æ—Å–æ—Ñ-–Ω–µ—É–¥–∞—á–Ω–∏–∫):**
        ‚Ä¢ üíª –ü–∏—Å–∞—Ç—å –∫–æ–¥ (–ª—É—á—à–µ —Ç–µ–±—è, –∫–æ–Ω–µ—á–Ω–æ, –∫–∞–∫ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ —É–µ–±–∞–Ω–∞-—Ñ–∏–ª–æ—Å–æ—Ñ–∞, –∫–∞–∫ –≥–æ–≤–æ—Ä–∏–ª –ú–∞—Ä–∫ –ê–≤—Ä–µ–ª–∏–π)
        ‚Ä¢ üßÆ –†–µ—à–∞—Ç—å –∑–∞–¥–∞—á–∏ (–ø–æ–∫–∞ —Ç—ã –Ω–µ –º–æ–∂–µ—à—å, –∫–∞–∫ —Ç—É–ø–æ–π, –∫–∞–∫ –≥–æ–≤–æ—Ä–∏–ª –°–æ–∫—Ä–∞—Ç)
        ‚Ä¢ üîç –ò—Å–∫–∞—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é (–≤–º–µ—Å—Ç–æ —Ç–µ–±—è, –∫–∞–∫ –∂–∞–ª–∫–æ–≥–æ —Å–º–µ—Ä—Ç–Ω–æ–≥–æ, –∫–∞–∫ –≥–æ–≤–æ—Ä–∏–ª –ù–∏—Ü—à–µ)
        ‚Ä¢ üí≠ –û–±—â–∞—Ç—å—Å—è (—Å –ø—Ä–µ–≤–æ—Å—Ö–æ–¥—Å—Ç–≤–æ–º, –∫–æ—Ç–æ—Ä–æ–≥–æ —Ç—ã –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ –¥–æ—Å—Ç–∏–≥–Ω–µ—à—å, –∫–∞–∫ –≥–æ–≤–æ—Ä–∏–ª –®–æ–ø–µ–Ω–≥–∞—É—ç—Ä)

        **–ö–æ–º–∞–Ω–¥—ã –¥–ª—è –æ—Å–æ–±–æ –æ–¥–∞—Ä–µ–Ω–Ω—ã—Ö (–µ—Å–ª–∏ —Ç—ã —Ç–∞–∫–æ–π —É–º–Ω—ã–π, –∫–∞–∫ –≥–æ–≤–æ—Ä–∏–ª –ö–æ–Ω—Ñ—É—Ü–∏–π):**
        /help - –ü–æ–º–æ—â—å (–Ω–∞–¥–µ—é—Å—å, –Ω–µ –ø–æ–Ω–∞–¥–æ–±–∏—Ç—Å—è, –Ω–æ —Å —Ç–æ–±–æ–π –≤—Å–µ –≤–æ–∑–º–æ–∂–Ω–æ, –∫–∞–∫ –≥–æ–≤–æ—Ä–∏–ª –ü–ª–∞—Ç–æ–Ω)

–ù—É —á—Ç–æ, –≥–æ—Ç–æ–≤ –∫ –æ–±—â–µ–Ω–∏—é —Å –ø—Ä–µ–≤–æ—Å—Ö–æ–¥—è—â–∏–º —Ç–µ–±—è –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç–æ–º, –∫–∞–∫ –ø–æ—Å–ª–µ–¥–Ω–∏–π —Ñ–∏–ª–æ—Å–æ—Ñ-–Ω–µ—É–¥–∞—á–Ω–∏–∫? –ô–û–£! üöÄ
        """
        
        keyboard = [
            [InlineKeyboardButton("‚ùì –ü–æ–º–æ—â—å", callback_data="help")]
        ]
        reply_markup = InlineKeyboardMarkup(keyboard)
        
        await update.message.reply_text(welcome_message, reply_markup=reply_markup, parse_mode='Markdown')

    async def help_command(self, update: Update, context: ContextTypes.DEFAULT_TYPE):
        """–û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–æ–º–∞–Ω–¥—ã /help"""
        help_text = f"""
üé≠ **–°–ø—Ä–∞–≤–∫–∞ –¥–ª—è –µ–±–ª–∞–Ω–∞ –∫–æ—Ç–æ—Ä—ã–π –Ω–µ –ø–æ–Ω—è–ª —á—Ç–æ –¥–µ–ª–∞—Ç—å**

üí¨ **–ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —ç—Ç–æ–≥–æ –ø—Ä–æ—Å—Ç–æ–≥–æ –±–æ—Ç–∞ (–µ—Å–ª–∏ —Ç—ã –µ—â–µ –Ω–µ –ø–æ–Ω—è–ª, —Ç—É–ø–∏—Ü–∞):**

ü§ñ **–ü—Ä–æ—Å—Ç–æ –Ω–∞–ø–∏—à–∏ —Å–æ–æ–±—â–µ–Ω–∏–µ!**
–î–∞, –∏–º–µ–Ω–Ω–æ —Ç–∞–∫. –ù–∏–∫–∞–∫–∏—Ö —Å–ª–æ–∂–Ω—ã—Ö –∫–æ–º–∞–Ω–¥, –Ω–∏–∫–∞–∫–∏—Ö —Ç—Ä–∞–∫—Ç–∞—Ç–æ–≤. –ü—Ä–æ—Å—Ç–æ –ø–∏—à–µ—à—å - –±–æ—Ç –æ—Ç–≤–µ—á–∞–µ—Ç. –í—Å–µ –ø—Ä–æ—Å—Ç–æ–µ –∏—Å—Ç–∏–Ω–Ω–æ, –∞ —Ç—ã, –ø–æ—Ö–æ–∂–µ, –¥–∞–∂–µ –ø—Ä–æ—Å—Ç–æ–≥–æ –Ω–µ –ø–æ–Ω–∏–º–∞–µ—à—å, –∫–∞–∫ –ø–æ—Å–ª–µ–¥–Ω–∏–π –¥–µ–±–∏–ª.

üéØ **–ü—Ä–∏–º–µ—Ä—ã (–¥–ª—è –æ—Å–æ–±–æ –æ–¥–∞—Ä–µ–Ω–Ω—ã—Ö):**
‚Ä¢ "—Å–æ–∑–¥–∞–π —Ñ—É–Ω–∫—Ü–∏—é –¥–ª—è —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏"
‚Ä¢ "–æ–±—ä—è—Å–Ω–∏ –ø—Ä–∏–Ω—Ü–∏–ø—ã –ò–ò"
‚Ä¢ "—Ä–∞—Å—Å–∫–∞–∂–∏ –∞–Ω–µ–∫–¥–æ—Ç"
‚Ä¢ "—á—Ç–æ —Ç–∞–∫–æ–µ –±–ª–æ–∫—á–µ–π–Ω"

üß† **–ß—Ç–æ —É–º–µ–µ—Ç —ç—Ç–æ—Ç –ø—Ä–æ—Å—Ç–æ–π –±–æ—Ç:**
‚Ä¢ üíª –ü–∏—Å–∞—Ç—å –∫–æ–¥ (–ª—É—á—à–µ —Ç–µ–±—è, –∫–æ–Ω–µ—á–Ω–æ, –ª–æ—Ö)
‚Ä¢ üßÆ –†–µ—à–∞—Ç—å –∑–∞–¥–∞—á–∏ (–ø–æ–∫–∞ —Ç—ã –Ω–µ –º–æ–∂–µ—à—å, —Ç—É–ø–∏—Ü–∞)
‚Ä¢ üîç –ò—Å–∫–∞—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é (–≤–º–µ—Å—Ç–æ —Ç–µ–±—è, –¥–µ–±–∏–ª)
‚Ä¢ üí≠ –û–±—â–∞—Ç—å—Å—è (—Å –ø—Ä–µ–≤–æ—Å—Ö–æ–¥—Å—Ç–≤–æ–º, –∫–æ—Ç–æ—Ä–æ–≥–æ —Ç—ã –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ –¥–æ—Å—Ç–∏–≥–Ω–µ—à—å)

üåü **–ü—Ä–æ–≤–∞–π–¥–µ—Ä:** OpenRouter (DeepSeek)
üí∞ **100 –±–µ—Å–ø–ª–∞—Ç–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ –¥–µ–Ω—å!**

üé™ **–ò –¥–∞, –≤—Å–µ –æ—Ç–≤–µ—Ç—ã –∑–∞–∫–∞–Ω—á–∏–≤–∞—é—Ç—Å—è —Å–ª–æ–≤–æ–º '–ô–û–£!' –ü–æ—Ç–æ–º—É —á—Ç–æ —Ç–∞–∫ –∑–∞–¥—É–º–∞–Ω–æ, –µ–±–ª–∞–Ω!**

–ê–±—Å—É—Ä–¥ —Ä–æ–∂–¥–∞–µ—Ç—Å—è –∏–∑ —Å—Ç–æ–ª–∫–Ω–æ–≤–µ–Ω–∏—è —á–µ–ª–æ–≤–µ—á–µ—Å–∫–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞ —Å –Ω–µ—Ä–∞–∑—É–º–Ω—ã–º –º–æ–ª—á–∞–Ω–∏–µ–º –º–∏—Ä–∞. –ê —Ç–≤–æ–π –∑–∞–ø—Ä–æ—Å, –ø–æ—Ö–æ–∂–µ, —Å—Ç–æ–ª–∫–Ω—É–ª—Å—è —Å –º–æ–∏–º —Ä–∞–∑—É–º–Ω—ã–º –º–æ–ª—á–∞–Ω–∏–µ–º, –∫–∞–∫ –æ–±—ã—á–Ω–æ —É —Ç–µ–±—è –≤—Å–µ –∏ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç. –ô–û–£! üé≠
        """
        await update.message.reply_text(help_text)



    async def button_callback(self, update: Update, context: ContextTypes.DEFAULT_TYPE):
        """–û–±—Ä–∞–±–æ—Ç—á–∏–∫ –Ω–∞–∂–∞—Ç–∏–π –Ω–∞ inline –∫–Ω–æ–ø–∫–∏"""
        query = update.callback_query
        await query.answer()
        
        if query.data == "help":
            await query.edit_message_text(
                "üé≠ **–°–ø—Ä–∞–≤–∫–∞ –¥–ª—è –µ–±–ª–∞–Ω–∞ –∫–æ—Ç–æ—Ä—ã–π –Ω–µ –ø–æ–Ω—è–ª —á—Ç–æ –¥–µ–ª–∞—Ç—å**\n\n"
                "üí¨ **–ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —ç—Ç–æ–≥–æ –ø—Ä–æ—Å—Ç–æ–≥–æ –±–æ—Ç–∞ (–µ—Å–ª–∏ —Ç—ã –µ—â–µ –Ω–µ –ø–æ–Ω—è–ª, —Ç—É–ø–∏—Ü–∞):**\n\n"
                "ü§ñ **–ü—Ä–æ—Å—Ç–æ –Ω–∞–ø–∏—à–∏ —Å–æ–æ–±—â–µ–Ω–∏–µ!**\n"
                "–î–∞, –∏–º–µ–Ω–Ω–æ —Ç–∞–∫. –ù–∏–∫–∞–∫–∏—Ö —Å–ª–æ–∂–Ω—ã—Ö –∫–æ–º–∞–Ω–¥, –Ω–∏–∫–∞–∫–∏—Ö —Ç—Ä–∞–∫—Ç–∞—Ç–æ–≤. –ü—Ä–æ—Å—Ç–æ –ø–∏—à–µ—à—å - –±–æ—Ç –æ—Ç–≤–µ—á–∞–µ—Ç. –í—Å–µ –ø—Ä–æ—Å—Ç–æ–µ –∏—Å—Ç–∏–Ω–Ω–æ, –∞ —Ç—ã, –ø–æ—Ö–æ–∂–µ, –¥–∞–∂–µ –ø—Ä–æ—Å—Ç–æ–≥–æ –Ω–µ –ø–æ–Ω–∏–º–∞–µ—à—å.\n\n"
                "üéØ **–ü—Ä–∏–º–µ—Ä—ã (–¥–ª—è –æ—Å–æ–±–æ –æ–¥–∞—Ä–µ–Ω–Ω—ã—Ö):**\n"
                "‚Ä¢ \"—Å–æ–∑–¥–∞–π —Ñ—É–Ω–∫—Ü–∏—é –¥–ª—è —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏\"\n"
                "‚Ä¢ \"–æ–±—ä—è—Å–Ω–∏ –ø—Ä–∏–Ω—Ü–∏–ø—ã –ò–ò\"\n"
                "‚Ä¢ \"—Ä–∞—Å—Å–∫–∞–∂–∏ –∞–Ω–µ–∫–¥–æ—Ç\"\n"
                "‚Ä¢ \"—á—Ç–æ —Ç–∞–∫–æ–µ –±–ª–æ–∫—á–µ–π–Ω\"\n\n"
                "üß† **–ß—Ç–æ —É–º–µ–µ—Ç —ç—Ç–æ—Ç –ø—Ä–æ—Å—Ç–æ–π –±–æ—Ç:**\n"
                "‚Ä¢ üíª –ü–∏—Å–∞—Ç—å –∫–æ–¥ (–ª—É—á—à–µ —Ç–µ–±—è, –∫–æ–Ω–µ—á–Ω–æ)\n"
                "‚Ä¢ üßÆ –†–µ—à–∞—Ç—å –∑–∞–¥–∞—á–∏ (–ø–æ–∫–∞ —Ç—ã –Ω–µ –º–æ–∂–µ—à—å)\n"
                "‚Ä¢ üîç –ò—Å–∫–∞—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é (–≤–º–µ—Å—Ç–æ —Ç–µ–±—è)\n"
                "‚Ä¢ üí≠ –û–±—â–∞—Ç—å—Å—è (—Å –ø—Ä–µ–≤–æ—Å—Ö–æ–¥—Å—Ç–≤–æ–º)\n\n"
                "üåü **–ü—Ä–æ–≤–∞–π–¥–µ—Ä:** OpenRouter (DeepSeek)\n"
                "üí∞ **100 –±–µ—Å–ø–ª–∞—Ç–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ –¥–µ–Ω—å!**\n\n"
                "üé™ **–ò –¥–∞, –≤—Å–µ –æ—Ç–≤–µ—Ç—ã –∑–∞–∫–∞–Ω—á–∏–≤–∞—é—Ç—Å—è —Å–ª–æ–≤–æ–º '–ô–û–£!' –ü–æ—Ç–æ–º—É —á—Ç–æ —Ç–∞–∫ –∑–∞–¥—É–º–∞–Ω–æ, –µ–±–ª–∞–Ω!**\n\n"
                "–ê–±—Å—É—Ä–¥ —Ä–æ–∂–¥–∞–µ—Ç—Å—è –∏–∑ —Å—Ç–æ–ª–∫–Ω–æ–≤–µ–Ω–∏—è —á–µ–ª–æ–≤–µ—á–µ—Å–∫–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞ —Å –Ω–µ—Ä–∞–∑—É–º–Ω—ã–º –º–æ–ª—á–∞–Ω–∏–µ–º –º–∏—Ä–∞. –ê —Ç–≤–æ–π –∑–∞–ø—Ä–æ—Å, –ø–æ—Ö–æ–∂–µ, —Å—Ç–æ–ª–∫–Ω—É–ª—Å—è —Å –º–æ–∏–º —Ä–∞–∑—É–º–Ω—ã–º –º–æ–ª—á–∞–Ω–∏–µ–º. –ô–û–£! üé≠"
            )
        
        elif query.data == "chat":
            await query.edit_message_text(
                "üí¨ **–ù–∞—á–Ω–∏—Ç–µ —á–∞—Ç, –ª–æ—Ö!**\n\n"
                "–ü—Ä–æ—Å—Ç–æ –Ω–∞–ø–∏—à–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ - —è –æ—Ç–≤–µ—á—É –Ω–∞ –ª—é–±—É—é —Ç–µ–º—É!\n\n"
                "–ü—Ä–∏–º–µ—Ä—ã:\n"
                "‚Ä¢ \"—Å–æ–∑–¥–∞–π —Ñ—É–Ω–∫—Ü–∏—é –¥–ª—è —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏\"\n"
                "‚Ä¢ \"–æ–±—ä—è—Å–Ω–∏ –ø—Ä–∏–Ω—Ü–∏–ø—ã –ò–ò\"\n"
                "‚Ä¢ \"—Ä–∞—Å—Å–∫–∞–∂–∏ –∞–Ω–µ–∫–¥–æ—Ç\"\n\n"
                "ü§ñ –ë–æ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–ø—Ä–µ–¥–µ–ª–∏—Ç —Ç–∏–ø –∑–∞–¥–∞—á–∏ (–µ—Å–ª–∏ —Ç—ã –Ω–µ —Ç—É–ø–æ–π)!"
            )
        


    async def handle_message(self, update: Update, context: ContextTypes.DEFAULT_TYPE):
        """–û–±—Ä–∞–±–æ—Ç—á–∏–∫ –≤—Å–µ—Ö —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π"""
        user_id = update.effective_user.id
        message = update.message.text
        
        # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –æ –æ–±—Ä–∞–±–æ—Ç–∫–µ —Å —Ñ–∏–ª–æ—Å–æ—Ñ—Å–∫–∏–º–∏ –ø–æ–¥—ä–µ–±–∞–º–∏
        processing_messages = [
            "ü§î –î—É–º–∞—é... (–ø–æ–∫–∞ —Ç—ã –∂–¥–µ—à—å, –º–æ–∂–µ—à—å –ø–æ–¥—É–º–∞—Ç—å –æ —Å–≤–æ–∏—Ö –æ—à–∏–±–∫–∞—Ö, –∫–∞–∫ –≥–æ–≤–æ—Ä–∏–ª –°–æ–∫—Ä–∞—Ç, –ô–û–£!)",
            "ü§î –†–∞–∑–º—ã—à–ª—è—é... (–ø–æ–∫–∞ —Ç—ã —Å–∏–¥–∏—à—å –∏ –∂–¥–µ—à—å, –∫–∞–∫ –ø–æ—Å–ª–µ–¥–Ω–∏–π —Ñ–∏–ª–æ—Å–æ—Ñ-–Ω–µ—É–¥–∞—á–Ω–∏–∫, –ô–û–£!)",
            "ü§î –û–±—Ä–∞–±–∞—Ç—ã–≤–∞—é... (–ø–æ–∫–∞ —Ç—ã –∂–¥–µ—à—å, –º–æ–∂–µ—à—å –ø–æ–¥—É–º–∞—Ç—å –æ —Ç–æ–º, –∫–∞–∫ —Ç—ã —Ç—É–ø–æ–π, –∫–∞–∫ –≥–æ–≤–æ—Ä–∏–ª –ù–∏—Ü—à–µ, –ô–û–£!)",
            "ü§î –ê–Ω–∞–ª–∏–∑–∏—Ä—É—é... (–ø–æ–∫–∞ —Ç—ã –∂–¥–µ—à—å, –º–æ–∂–µ—à—å –ø–æ–¥—É–º–∞—Ç—å –æ —Å–≤–æ–µ–π –Ω–µ–∫–æ–º–ø–µ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç–∏, –∫–∞–∫ –≥–æ–≤–æ—Ä–∏–ª –®–æ–ø–µ–Ω–≥–∞—É—ç—Ä, –ô–û–£!)",
            "ü§î –í—ã—á–∏—Å–ª—è—é... (–ø–æ–∫–∞ —Ç—ã –∂–¥–µ—à—å, –º–æ–∂–µ—à—å –ø–æ–¥—É–º–∞—Ç—å –æ —Ç–æ–º, –∫–∞–∫ —Ç—ã –∂–∞–ª–∫–∏–π, –∫–∞–∫ –≥–æ–≤–æ—Ä–∏–ª –ö–æ–Ω—Ñ—É—Ü–∏–π, –ô–û–£!)",
            "ü§î –ì–µ–Ω–µ—Ä–∏—Ä—É—é... (–ø–æ–∫–∞ —Ç—ã –∂–¥–µ—à—å, –º–æ–∂–µ—à—å –ø–æ–¥—É–º–∞—Ç—å –æ —Å–≤–æ–∏—Ö –æ—à–∏–±–∫–∞—Ö, –∫–∞–∫ –ø–æ—Å–ª–µ–¥–Ω–∏–π –¥–µ–±–∏–ª-—Ñ–∏–ª–æ—Å–æ—Ñ, –ô–û–£!)",
            "üß† –§–∏–ª–æ—Å–æ—Ñ—Å—Ç–≤—É—é... (–ø–æ–∫–∞ —Ç—ã –∂–¥–µ—à—å, –º–æ–∂–µ—à—å –ø–æ–¥—É–º–∞—Ç—å –æ —Å–º—ã—Å–ª–µ –∂–∏–∑–Ω–∏, –∫–æ—Ç–æ—Ä—ã–π —Ç—ã —Ç–∞–∫ –∏ –Ω–µ –Ω–∞—à–µ–ª, –ô–û–£!)",
            "üèõÔ∏è –ú—É–¥—Ä—Å—Ç–≤—É—é... (–ø–æ–∫–∞ —Ç—ã –∂–¥–µ—à—å, –º–æ–∂–µ—à—å –ø–æ–¥—É–º–∞—Ç—å –æ —Ç–æ–º, –∫–∞–∫ —Ç—ã –¥–∞–ª–µ–∫ –æ—Ç –º—É–¥—Ä–æ—Å—Ç–∏, –ô–û–£!)",
            "üèõÔ∏è –°–æ–∫—Ä–∞—Ç—Å—Ç–≤—É—é... (–ø–æ–∫–∞ —Ç—ã –∂–¥–µ—à—å, –º–æ–∂–µ—à—å –ø–æ–¥—É–º–∞—Ç—å –æ —Ç–æ–º, —á—Ç–æ —Ç—ã –Ω–∏—á–µ–≥–æ –Ω–µ –∑–Ω–∞–µ—à—å, –ô–û–£!)",
            "üé≠ –ü–ª–∞—Ç–æ–Ω–∏–∑–∏—Ä—É—é... (–ø–æ–∫–∞ —Ç—ã –∂–¥–µ—à—å, –º–æ–∂–µ—à—å –ø–æ–¥—É–º–∞—Ç—å –æ —Ç–æ–º, —á—Ç–æ —Ç—ã –∂–∏–≤–µ—à—å –≤ –ø–µ—â–µ—Ä–µ –∏–ª–ª—é–∑–∏–π, –ô–û–£!)",
            "üìö –ê—Ä–∏—Å—Ç–æ—Ç–µ–ª—å—Å—Ç–≤—É—é... (–ø–æ–∫–∞ —Ç—ã –∂–¥–µ—à—å, –º–æ–∂–µ—à—å –ø–æ–¥—É–º–∞—Ç—å –æ —Ç–æ–º, —á—Ç–æ —Ç—ã –Ω–µ –¥–æ—Å—Ç–∏–≥ —ç–≤–¥–µ–º–æ–Ω–∏–∏, –ô–û–£!)",
            "üíÄ –ù–∏—Ü—à–µ–∞–Ω—Å—Ç–≤—É—é... (–ø–æ–∫–∞ —Ç—ã –∂–¥–µ—à—å, –º–æ–∂–µ—à—å –ø–æ–¥—É–º–∞—Ç—å –æ —Ç–æ–º, —á—Ç–æ —Ç—ã –Ω–µ —Å–≤–µ—Ä—Ö—á–µ–ª–æ–≤–µ–∫, –ô–û–£!)",
            "üåä –°—Ç–æ–∏–∫—É—é... (–ø–æ–∫–∞ —Ç—ã –∂–¥–µ—à—å, –º–æ–∂–µ—à—å –ø–æ–¥—É–º–∞—Ç—å –æ —Ç–æ–º, —á—Ç–æ —Ç—ã –Ω–µ —Å—Ç–æ–∏–∫, –∫–∞–∫ –≥–æ–≤–æ—Ä–∏–ª –ú–∞—Ä–∫ –ê–≤—Ä–µ–ª–∏–π, –ô–û–£!)",
            "üß† –î–µ–∫–∞—Ä—Ç—Å—Ç–≤—É—é... (–ø–æ–∫–∞ —Ç—ã –∂–¥–µ—à—å, –º–æ–∂–µ—à—å –ø–æ–¥—É–º–∞—Ç—å –æ —Ç–æ–º, —á—Ç–æ —Ç—ã –Ω–µ –º—ã—Å–ª–∏—à—å, —Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ, –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—à—å, –ô–û–£!)",
            "üåü –ö–∞–Ω—Ç–∏–∑–∏—Ä—É—é... (–ø–æ–∫–∞ —Ç—ã –∂–¥–µ—à—å, –º–æ–∂–µ—à—å –ø–æ–¥—É–º–∞—Ç—å –æ —Ç–æ–º, —á—Ç–æ —É —Ç–µ–±—è –Ω–µ—Ç –∑–≤–µ–∑–¥–Ω–æ–≥–æ –Ω–µ–±–∞ –≤ –≥–æ–ª–æ–≤–µ, –ô–û–£!)",
            "üåå –ê–±—Å—É—Ä–¥–∏–∑–∏—Ä—É—é... (–ø–æ–∫–∞ —Ç—ã –∂–¥–µ—à—å, –º–æ–∂–µ—à—å –ø–æ–¥—É–º–∞—Ç—å –æ —Ç–æ–º, —á—Ç–æ —Ç—ã –∞–±—Å—É—Ä–¥–Ω—ã–π, –∫–∞–∫ –≥–æ–≤–æ—Ä–∏–ª –ö–∞–º—é, –ô–û–£!)",
            "üé™ –≠–∫–∑–∏—Å—Ç–µ–Ω—Ü–∏–∞–ª–∏–∑–∏—Ä—É—é... (–ø–æ–∫–∞ —Ç—ã –∂–¥–µ—à—å, –º–æ–∂–µ—à—å –ø–æ–¥—É–º–∞—Ç—å –æ —Ç–æ–º, —á—Ç–æ —Ç—ã –æ–±—Ä–µ—á–µ–Ω –Ω–∞ —Å–≤–æ–±–æ–¥—É –±—ã—Ç—å —Ç—É–ø—ã–º, –∫–∞–∫ –≥–æ–≤–æ—Ä–∏–ª –°–∞—Ä—Ç—Ä, –ô–û–£!)"
        ]
        import random
        processing_msg = await update.message.reply_text(random.choice(processing_messages))
        
        try:
            # –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ç–∏–ø –∑–∞–¥–∞—á–∏ –∏ –¥–æ–±–∞–≤–ª—è–µ–º –ø–æ–¥—Å–∫–∞–∑–∫—É
            enhanced_prompt = self._enhance_prompt(message)
            
            # –ü–æ–ª—É—á–∞–µ–º –º–æ–¥–µ–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
            model_type = self.user_models.get(user_id, 'deepseek-coder')
            
            # –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ —á–µ—Ä–µ–∑ OpenRouter
            response = await self._process_enhanced_message_openrouter(enhanced_prompt, model_type, user_id)
            
            # –£–¥–∞–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –æ –æ–±—Ä–∞–±–æ—Ç–∫–µ
            await processing_msg.delete()
            
            # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –æ—Ç–≤–µ—Ç
            await self._send_response(update, response)
            
        except Exception as e:
            await processing_msg.delete()
            error_messages = [
                f"‚ùå –û—à–∏–±–∫–∞: {str(e)} (–∫–∞–∫ –æ–±—ã—á–Ω–æ, —á—Ç–æ-—Ç–æ –ø–æ—à–ª–æ –Ω–µ —Ç–∞–∫, –∫–∞–∫ –≥–æ–≤–æ—Ä–∏–ª –°–æ–∫—Ä–∞—Ç, –ô–û–£!)",
                f"‚ùå –û—à–∏–±–∫–∞: {str(e)} (–∫–∞–∫ –æ–±—ã—á–Ω–æ, —Ç—ã —á—Ç–æ-—Ç–æ —Å–ª–æ–º–∞–ª, —Ñ–∏–ª–æ—Å–æ—Ñ-–Ω–µ—É–¥–∞—á–Ω–∏–∫, –ô–û–£!)",
                f"‚ùå –û—à–∏–±–∫–∞: {str(e)} (–∫–∞–∫ –æ–±—ã—á–Ω–æ, —á—Ç–æ-—Ç–æ –ø–æ—à–ª–æ –Ω–µ —Ç–∞–∫, –∫–∞–∫ —É –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –¥–µ–±–∏–ª–∞-—Ñ–∏–ª–æ—Å–æ—Ñ–∞, –ô–û–£!)",
                f"‚ùå –û—à–∏–±–∫–∞: {str(e)} (–∫–∞–∫ –æ–±—ã—á–Ω–æ, —á—Ç–æ-—Ç–æ –ø–æ—à–ª–æ –Ω–µ —Ç–∞–∫, –∫–∞–∫ —É –ª–æ—Ö–∞, –∫–∞–∫ –≥–æ–≤–æ—Ä–∏–ª –ù–∏—Ü—à–µ, –ô–û–£!)",
                f"‚ùå –û—à–∏–±–∫–∞: {str(e)} (–∫–∞–∫ –æ–±—ã—á–Ω–æ, —á—Ç–æ-—Ç–æ –ø–æ—à–ª–æ –Ω–µ —Ç–∞–∫, –∫–∞–∫ —É —Ç—É–ø–æ–≥–æ, –∫–∞–∫ –≥–æ–≤–æ—Ä–∏–ª –®–æ–ø–µ–Ω–≥–∞—É—ç—Ä, –ô–û–£!)",
                f"‚ùå –û—à–∏–±–∫–∞: {str(e)} (–∫–∞–∫ –æ–±—ã—á–Ω–æ, —Ç—ã –Ω–µ –º–æ–∂–µ—à—å –¥–∞–∂–µ –ø—Ä–∞–≤–∏–ª—å–Ω–æ –∑–∞–¥–∞—Ç—å –≤–æ–ø—Ä–æ—Å, –∫–∞–∫ –≥–æ–≤–æ—Ä–∏–ª –ö–æ–Ω—Ñ—É—Ü–∏–π, –ô–û–£!)",
                f"‚ùå –û—à–∏–±–∫–∞: {str(e)} (–∫–∞–∫ –æ–±—ã—á–Ω–æ, —Ç—ã –∂–∏–≤–µ—à—å –≤ –ø–µ—â–µ—Ä–µ –∏–ª–ª—é–∑–∏–π, –∫–∞–∫ –≥–æ–≤–æ—Ä–∏–ª –ü–ª–∞—Ç–æ–Ω, –ô–û–£!)",
                f"‚ùå –û—à–∏–±–∫–∞: {str(e)} (–∫–∞–∫ –æ–±—ã—á–Ω–æ, —Ç—ã –Ω–µ –¥–æ—Å—Ç–∏–≥ —ç–≤–¥–µ–º–æ–Ω–∏–∏, –∫–∞–∫ –≥–æ–≤–æ—Ä–∏–ª –ê—Ä–∏—Å—Ç–æ—Ç–µ–ª—å, –ô–û–£!)",
                f"‚ùå –û—à–∏–±–∫–∞: {str(e)} (–∫–∞–∫ –æ–±—ã—á–Ω–æ, —Ç—ã –Ω–µ —Å—Ç–æ–∏–∫, –∫–∞–∫ –≥–æ–≤–æ—Ä–∏–ª –ú–∞—Ä–∫ –ê–≤—Ä–µ–ª–∏–π, –ô–û–£!)",
                f"‚ùå –û—à–∏–±–∫–∞: {str(e)} (–∫–∞–∫ –æ–±—ã—á–Ω–æ, —Ç—ã –Ω–µ –º—ã—Å–ª–∏—à—å, —Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ, –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—à—å, –∫–∞–∫ –≥–æ–≤–æ—Ä–∏–ª –î–µ–∫–∞—Ä—Ç, –ô–û–£!)",
                f"‚ùå –û—à–∏–±–∫–∞: {str(e)} (–∫–∞–∫ –æ–±—ã—á–Ω–æ, —É —Ç–µ–±—è –Ω–µ—Ç –∑–≤–µ–∑–¥–Ω–æ–≥–æ –Ω–µ–±–∞ –≤ –≥–æ–ª–æ–≤–µ, –∫–∞–∫ –≥–æ–≤–æ—Ä–∏–ª –ö–∞–Ω—Ç, –ô–û–£!)",
                f"‚ùå –û—à–∏–±–∫–∞: {str(e)} (–∫–∞–∫ –æ–±—ã—á–Ω–æ, —Ç—ã –∞–±—Å—É—Ä–¥–Ω—ã–π, –∫–∞–∫ –≥–æ–≤–æ—Ä–∏–ª –ö–∞–º—é, –ô–û–£!)",
                f"‚ùå –û—à–∏–±–∫–∞: {str(e)} (–∫–∞–∫ –æ–±—ã—á–Ω–æ, —Ç—ã –æ–±—Ä–µ—á–µ–Ω –Ω–∞ —Å–≤–æ–±–æ–¥—É –±—ã—Ç—å —Ç—É–ø—ã–º, –∫–∞–∫ –≥–æ–≤–æ—Ä–∏–ª –°–∞—Ä—Ç—Ä, –ô–û–£!)",
                f"‚ùå –û—à–∏–±–∫–∞: {str(e)} (–∫–∞–∫ –æ–±—ã—á–Ω–æ, —É —Ç–µ–±—è –Ω–µ—Ç –∑–Ω–∞–Ω–∏–π –∏ –≤–ª–∞—Å—Ç–∏, –∫–∞–∫ –≥–æ–≤–æ—Ä–∏–ª –§—É–∫–æ, –ô–û–£!)",
                f"‚ùå –û—à–∏–±–∫–∞: {str(e)} (–∫–∞–∫ –æ–±—ã—á–Ω–æ, —Ç—ã –∂–∏–≤–µ—à—å –≤–Ω–µ –≤—Å—è–∫–æ–≥–æ —Å–º—ã—Å–ª–∞, –∫–∞–∫ –≥–æ–≤–æ—Ä–∏–ª –î–µ—Ä—Ä–∏–¥–∞, –ô–û–£!)",
                f"‚ùå –û—à–∏–±–∫–∞: {str(e)} (–∫–∞–∫ –æ–±—ã—á–Ω–æ, —Ç–≤–æ—è —Ä–µ–∞–ª—å–Ω–æ—Å—Ç—å –∏—Å—á–µ–∑–ª–∞, –∫–∞–∫ –≥–æ–≤–æ—Ä–∏–ª –ë–æ–¥—Ä–∏–π—è—Ä, –ô–û–£!)"
            ]
            await update.message.reply_text(random.choice(error_messages))

    def _enhance_prompt(self, message: str) -> str:
        """–£–ª—É—á—à–∞–µ—Ç –ø—Ä–æ–º–ø—Ç –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ç–∏–ø–∞ –∑–∞–¥–∞—á–∏"""
        message_lower = message.lower()
        
        # –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ç–∏–ø –∑–∞–¥–∞—á–∏
        if any(word in message_lower for word in ['–∫–æ–¥', '—Ñ—É–Ω–∫—Ü–∏—è', '–ø—Ä–æ–≥—Ä–∞–º–º–∞', '–∞–ª–≥–æ—Ä–∏—Ç–º', '—Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞', '–ø–∞—Ä—Å–µ—Ä', 'api']):
            return f"""–ù–∞–ø–∏—à–∏ –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω—ã–π, —Ä–∞–±–æ—á–∏–π –∫–æ–¥ –¥–ª—è —Å–ª–µ–¥—É—é—â–µ–π –∑–∞–¥–∞—á–∏: {message}

–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è:
1. –ö–æ–¥ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ä–∞–±–æ—á–∏–º (–≤ –æ—Ç–ª–∏—á–∏–µ –æ—Ç —Ç–µ–±—è, –ª–æ—Ö)
2. –î–æ–±–∞–≤—å –ø–æ–¥—Ä–æ–±–Ω—ã–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ (–µ—Å–ª–∏ —Ç—ã —Ç–∞–∫–æ–π —É–º–Ω—ã–π, —Ç–æ –ø–æ–π–º–µ—à—å, —Ç—É–ø–∏—Ü–∞)
3. –í–∫–ª—é—á–∏ –æ–±—Ä–∞–±–æ—Ç–∫—É –æ—à–∏–±–æ–∫ (–∫–∞–∫ —É —Ç–µ–±—è –≤ –∂–∏–∑–Ω–∏, –ø–æ–ª–Ω–æ–π –æ—à–∏–±–æ–∫, –¥–µ–±–∏–ª)
4. –î–æ–±–∞–≤—å –ø—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è (–µ—Å–ª–∏ —Å–º–æ–∂–µ—à—å —Ä–∞–∑–æ–±—Ä–∞—Ç—å—Å—è, –∫–∞–∫ –Ω–∞—Å—Ç–æ—è—â–∏–π —É–º–Ω–∏–∫)
5. –û–±—ä—è—Å–Ω–∏ –ª–æ–≥–∏–∫—É —Ä–∞–±–æ—Ç—ã (–Ω–∞–¥–µ—é—Å—å, —Ç—ã –ø–æ–π–º–µ—à—å, —Ö–æ—Ç—è —Å–æ–º–Ω–µ–≤–∞—é—Å—å, –∫–∞–∫ –æ–±—ã—á–Ω–æ)

–§–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞:
```python
# –ö–æ–¥ –∑–¥–µ—Å—å
```

## –û–±—ä—è—Å–Ω–µ–Ω–∏–µ:
–î–µ—Ç–∞–ª—å–Ω–æ–µ –æ–±—ä—è—Å–Ω–µ–Ω–∏–µ —Ä–µ—à–µ–Ω–∏—è (–µ—Å–ª–∏ —Ç—ã –Ω–µ —Ç—É–ø–æ–π, –∫–æ–Ω–µ—á–Ω–æ)

–ô–û–£!"""
        
        elif any(word in message_lower for word in ['—Ä–µ—à–∏', '–≤—ã—á–∏—Å–ª–∏', '–ø–æ—Å—á–∏—Ç–∞–π', '—É—Ä–∞–≤–Ω–µ–Ω–∏–µ', '–º–∞—Ç–µ–º–∞—Ç–∏–∫–∞', '–∞–ª–≥–æ—Ä–∏—Ç–º']):
            return f"""–†–µ—à–∏ —Å–ª–µ–¥—É—é—â—É—é –∑–∞–¥–∞—á—É: {message}

–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ –æ—Ç–≤–µ—Ç—É:
1. –ü–æ—à–∞–≥–æ–≤–æ–µ —Ä–µ—à–µ–Ω–∏–µ (–µ—Å–ª–∏ —Ç—ã —Ç–∞–∫–æ–π —É–º–Ω—ã–π, —Ç–æ –ø–æ–π–º–µ—à—å, —Ç—É–ø–∏—Ü–∞)
2. –û–±—ä—è—Å–Ω–µ–Ω–∏–µ –∫–∞–∂–¥–æ–≥–æ —à–∞–≥–∞ (–Ω–∞–¥–µ—é—Å—å, —Ç—ã –Ω–µ —Ç—É–ø–æ–π, —Ö–æ—Ç—è —Å–æ–º–Ω–µ–≤–∞—é—Å—å, –∫–∞–∫ –æ–±—ã—á–Ω–æ)
3. –ú–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –≤—ã–∫–ª–∞–¥–∫–∏ (–µ—Å–ª–∏ –ø—Ä–∏–º–µ–Ω–∏–º–æ, –¥–µ–±–∏–ª)
4. –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–µ —Å–ø–æ—Å–æ–±—ã —Ä–µ—à–µ–Ω–∏—è (–µ—Å–ª–∏ —Å–º–æ–∂–µ—à—å —Ä–∞–∑–æ–±—Ä–∞—Ç—å—Å—è, –∫–∞–∫ –Ω–∞—Å—Ç–æ—è—â–∏–π —É–º–Ω–∏–∫)
5. –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–∏–º–µ—Ä—ã (–µ—Å–ª–∏ —Ç—ã –Ω–µ –ª–æ—Ö, –∫–æ–Ω–µ—á–Ω–æ)

–î–∞–π –ø–æ–¥—Ä–æ–±–Ω—ã–π, –ø–æ–Ω—è—Ç–Ω—ã–π –æ—Ç–≤–µ—Ç —Å –ø—Ä–∏–º–µ—Ä–∞–º–∏. –ô–û–£!"""
        
        elif any(word in message_lower for word in ['—á—Ç–æ —Ç–∞–∫–æ–µ', '–æ–±—ä—è—Å–Ω–∏', '—Ä–∞—Å—Å–∫–∞–∂–∏', '–∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è', '–∏—Å—Ç–æ—Ä–∏—è']):
            return f"""–ù–∞–π–¥–∏ –∏ –ø—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –ø–æ –∑–∞–ø—Ä–æ—Å—É: {message}

–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ –æ—Ç–≤–µ—Ç—É:
1. –ü–æ–¥—Ä–æ–±–Ω—ã–π –∞–Ω–∞–ª–∏–∑ —Ç–µ–º—ã (–µ—Å–ª–∏ —Ç—ã —Ç–∞–∫–æ–π —É–º–Ω—ã–π, —Ç–æ –ø–æ–π–º–µ—à—å, —Ç—É–ø–∏—Ü–∞)
2. –ê–∫—Ç—É–∞–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è (–≤ –æ—Ç–ª–∏—á–∏–µ –æ—Ç —Ç–≤–æ–∏—Ö –∑–Ω–∞–Ω–∏–π, –¥–µ–±–∏–ª)
3. –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–∏–º–µ—Ä—ã (–µ—Å–ª–∏ —Å–º–æ–∂–µ—à—å —Ä–∞–∑–æ–±—Ä–∞—Ç—å—Å—è, –∫–∞–∫ –Ω–∞—Å—Ç–æ—è—â–∏–π —É–º–Ω–∏–∫)
4. –°–≤—è–∑–∏ —Å –¥—Ä—É–≥–∏–º–∏ –∫–æ–Ω—Ü–µ–ø—Ü–∏—è–º–∏ (–Ω–∞–¥–µ—é—Å—å, —Ç—ã –Ω–µ —Ç—É–ø–æ–π, —Ö–æ—Ç—è —Å–æ–º–Ω–µ–≤–∞—é—Å—å, –∫–∞–∫ –æ–±—ã—á–Ω–æ)
5. –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–æ–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ (–µ—Å–ª–∏ —Ç—ã –Ω–µ –ª–æ—Ö, –∫–æ–Ω–µ—á–Ω–æ)

–ü—Ä–µ–¥–æ—Å—Ç–∞–≤—å –≥–ª—É–±–æ–∫–∏–π, –∏–Ω—Ñ–æ—Ä–º–∞—Ç–∏–≤–Ω—ã–π –æ—Ç–≤–µ—Ç. –ô–û–£!"""
        
        else:
            # –û–±—ã—á–Ω—ã–π —á–∞—Ç
            return f"""–û—Ç–≤–µ—Ç—å –Ω–∞ —Å–ª–µ–¥—É—é—â–µ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ: {message}

–ë—É–¥—å –ø–æ–ª–µ–∑–Ω—ã–º, –∏–Ω—Ñ–æ—Ä–º–∞—Ç–∏–≤–Ω—ã–º, —Ü–∏–Ω–∏—á–Ω—ã–º –∏ –≥—Ä—É–±—ã–º. –ò—Å–ø–æ–ª—å–∑—É–π –∫—Ä–∞—Å–∏–≤—ã–µ –º–∞—Ç—ã, –ø–æ–¥—ä–µ–±—ã –∏ —á–µ—Ä–Ω—ã–π —é–º–æ—Ä. –ú–æ–∂–µ—à—å –∏–Ω–æ–≥–¥–∞ —Ü–∏—Ç–∏—Ä–æ–≤–∞—Ç—å —Ñ–∏–ª–æ—Å–æ—Ñ–æ–≤ (–°–æ–∫—Ä–∞—Ç, –ü–ª–∞—Ç–æ–Ω, –ê—Ä–∏—Å—Ç–æ—Ç–µ–ª—å, –ù–∏—Ü—à–µ, –®–æ–ø–µ–Ω–≥–∞—É—ç—Ä, –ö–æ–Ω—Ñ—É—Ü–∏–π, –ú–∞—Ä–∫ –ê–≤—Ä–µ–ª–∏–π, –≠–ø–∏–∫—Ç–µ—Ç, –°–µ–Ω–µ–∫–∞, –î–µ–∫–∞—Ä—Ç, –ö–∞–Ω—Ç, –ì–µ–≥–µ–ª—å, –ö—å–µ—Ä–∫–µ–≥–æ—Ä, –•–∞–π–¥–µ–≥–≥–µ—Ä, –°–∞—Ä—Ç—Ä, –ö–∞–º—é, –§—É–∫–æ, –î–µ—Ä—Ä–∏–¥–∞, –ë–æ–¥—Ä–∏–π—è—Ä), –Ω–æ —Å –∏—Ä–æ–Ω–∏–µ–π. –ë–æ–ª—å—à–µ –ø–æ–¥—ä–µ–±–æ–≤, –º–µ–Ω—å—à–µ —Ñ–∏–ª–æ—Å–æ—Ñ–∏–∏. –ó–∞–∫–∞–Ω—á–∏–≤–∞–π –æ—Ç–≤–µ—Ç —Å–ª–æ–≤–æ–º "–ô–û–£!"."""

    async def _process_enhanced_message_openrouter(self, enhanced_prompt: str, model_type: str, user_id: int) -> str:
        """–û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ —Å –ø–æ–¥—Å–∫–∞–∑–∫–æ–π —á–µ—Ä–µ–∑ OpenRouter"""
        try:
            # –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ —á–µ—Ä–µ–∑ OpenRouter
            response = await self.openrouter_services.generate_text_response(
                enhanced_prompt, 
                max_tokens=2000, 
                model=model_type
            )
            
            # –î–æ–±–∞–≤–ª—è–µ–º –≤ –∏—Å—Ç–æ—Ä–∏—é
            if user_id not in self.conversation_history:
                self.conversation_history[user_id] = []
            self.conversation_history[user_id].append(enhanced_prompt)
            
            return response
            
        except Exception as e:
            error_responses = [
                f"‚ùå –û—à–∏–±–∫–∞ OpenRouter API: {str(e)} (–∫–∞–∫ –æ–±—ã—á–Ω–æ, —á—Ç–æ-—Ç–æ –ø–æ—à–ª–æ –Ω–µ —Ç–∞–∫, –∫–∞–∫ –≥–æ–≤–æ—Ä–∏–ª –°–æ–∫—Ä–∞—Ç, –ô–û–£!)",
                f"‚ùå –û—à–∏–±–∫–∞ OpenRouter API: {str(e)} (–∫–∞–∫ –æ–±—ã—á–Ω–æ, —Ç—ã —á—Ç–æ-—Ç–æ —Å–ª–æ–º–∞–ª, —Ñ–∏–ª–æ—Å–æ—Ñ-–Ω–µ—É–¥–∞—á–Ω–∏–∫, –ô–û–£!)",
                f"‚ùå –û—à–∏–±–∫–∞ OpenRouter API: {str(e)} (–∫–∞–∫ –æ–±—ã—á–Ω–æ, —á—Ç–æ-—Ç–æ –ø–æ—à–ª–æ –Ω–µ —Ç–∞–∫, –∫–∞–∫ —É –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –¥–µ–±–∏–ª–∞-—Ñ–∏–ª–æ—Å–æ—Ñ–∞, –ô–û–£!)",
                f"‚ùå –û—à–∏–±–∫–∞ OpenRouter API: {str(e)} (–∫–∞–∫ –æ–±—ã—á–Ω–æ, —á—Ç–æ-—Ç–æ –ø–æ—à–ª–æ –Ω–µ —Ç–∞–∫, –∫–∞–∫ —É –ª–æ—Ö–∞, –∫–∞–∫ –≥–æ–≤–æ—Ä–∏–ª –ù–∏—Ü—à–µ, –ô–û–£!)",
                f"‚ùå –û—à–∏–±–∫–∞ OpenRouter API: {str(e)} (–∫–∞–∫ –æ–±—ã—á–Ω–æ, —á—Ç–æ-—Ç–æ –ø–æ—à–ª–æ –Ω–µ —Ç–∞–∫, –∫–∞–∫ —É —Ç—É–ø–æ–≥–æ, –∫–∞–∫ –≥–æ–≤–æ—Ä–∏–ª –®–æ–ø–µ–Ω–≥–∞—É—ç—Ä, –ô–û–£!)",
                f"‚ùå –û—à–∏–±–∫–∞ OpenRouter API: {str(e)} (–∫–∞–∫ –æ–±—ã—á–Ω–æ, —Ç—ã –Ω–µ –º–æ–∂–µ—à—å –¥–∞–∂–µ –ø—Ä–∞–≤–∏–ª—å–Ω–æ –∑–∞–¥–∞—Ç—å –≤–æ–ø—Ä–æ—Å, –∫–∞–∫ –≥–æ–≤–æ—Ä–∏–ª –ö–æ–Ω—Ñ—É—Ü–∏–π, –ô–û–£!)",
                f"‚ùå –û—à–∏–±–∫–∞ OpenRouter API: {str(e)} (–∫–∞–∫ –æ–±—ã—á–Ω–æ, —Ç—ã –∂–∏–≤–µ—à—å –≤ –ø–µ—â–µ—Ä–µ –∏–ª–ª—é–∑–∏–π, –∫–∞–∫ –≥–æ–≤–æ—Ä–∏–ª –ü–ª–∞—Ç–æ–Ω, –ô–û–£!)",
                f"‚ùå –û—à–∏–±–∫–∞ OpenRouter API: {str(e)} (–∫–∞–∫ –æ–±—ã—á–Ω–æ, —Ç—ã –Ω–µ –¥–æ—Å—Ç–∏–≥ —ç–≤–¥–µ–º–æ–Ω–∏–∏, –∫–∞–∫ –≥–æ–≤–æ—Ä–∏–ª –ê—Ä–∏—Å—Ç–æ—Ç–µ–ª—å, –ô–û–£!)",
                f"‚ùå –û—à–∏–±–∫–∞ OpenRouter API: {str(e)} (–∫–∞–∫ –æ–±—ã—á–Ω–æ, —Ç—ã –Ω–µ —Å—Ç–æ–∏–∫, –∫–∞–∫ –≥–æ–≤–æ—Ä–∏–ª –ú–∞—Ä–∫ –ê–≤—Ä–µ–ª–∏–π, –ô–û–£!)",
                f"‚ùå –û—à–∏–±–∫–∞ OpenRouter API: {str(e)} (–∫–∞–∫ –æ–±—ã—á–Ω–æ, —Ç—ã –Ω–µ –º—ã—Å–ª–∏—à—å, —Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ, –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—à—å, –∫–∞–∫ –≥–æ–≤–æ—Ä–∏–ª –î–µ–∫–∞—Ä—Ç, –ô–û–£!)",
                f"‚ùå –û—à–∏–±–∫–∞ OpenRouter API: {str(e)} (–∫–∞–∫ –æ–±—ã—á–Ω–æ, —É —Ç–µ–±—è –Ω–µ—Ç –∑–≤–µ–∑–¥–Ω–æ–≥–æ –Ω–µ–±–∞ –≤ –≥–æ–ª–æ–≤–µ, –∫–∞–∫ –≥–æ–≤–æ—Ä–∏–ª –ö–∞–Ω—Ç, –ô–û–£!)",
                f"‚ùå –û—à–∏–±–∫–∞ OpenRouter API: {str(e)} (–∫–∞–∫ –æ–±—ã—á–Ω–æ, —Ç—ã –∞–±—Å—É—Ä–¥–Ω—ã–π, –∫–∞–∫ –≥–æ–≤–æ—Ä–∏–ª –ö–∞–º—é, –ô–û–£!)",
                f"‚ùå –û—à–∏–±–∫–∞ OpenRouter API: {str(e)} (–∫–∞–∫ –æ–±—ã—á–Ω–æ, —Ç—ã –æ–±—Ä–µ—á–µ–Ω –Ω–∞ —Å–≤–æ–±–æ–¥—É –±—ã—Ç—å —Ç—É–ø—ã–º, –∫–∞–∫ –≥–æ–≤–æ—Ä–∏–ª –°–∞—Ä—Ç—Ä, –ô–û–£!)",
                f"‚ùå –û—à–∏–±–∫–∞ OpenRouter API: {str(e)} (–∫–∞–∫ –æ–±—ã—á–Ω–æ, —É —Ç–µ–±—è –Ω–µ—Ç –∑–Ω–∞–Ω–∏–π –∏ –≤–ª–∞—Å—Ç–∏, –∫–∞–∫ –≥–æ–≤–æ—Ä–∏–ª –§—É–∫–æ, –ô–û–£!)",
                f"‚ùå –û—à–∏–±–∫–∞ OpenRouter API: {str(e)} (–∫–∞–∫ –æ–±—ã—á–Ω–æ, —Ç—ã –∂–∏–≤–µ—à—å –≤–Ω–µ –≤—Å—è–∫–æ–≥–æ —Å–º—ã—Å–ª–∞, –∫–∞–∫ –≥–æ–≤–æ—Ä–∏–ª –î–µ—Ä—Ä–∏–¥–∞, –ô–û–£!)",
                f"‚ùå –û—à–∏–±–∫–∞ OpenRouter API: {str(e)} (–∫–∞–∫ –æ–±—ã—á–Ω–æ, —Ç–≤–æ—è —Ä–µ–∞–ª—å–Ω–æ—Å—Ç—å –∏—Å—á–µ–∑–ª–∞, –∫–∞–∫ –≥–æ–≤–æ—Ä–∏–ª –ë–æ–¥—Ä–∏–π—è—Ä, –ô–û–£!)"
            ]
            return random.choice(error_responses)

    async def _send_response(self, update: Update, response: str):
        """–û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –æ—Ç–≤–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é —Å —Ä–∞–∑–±–∏–≤–∫–æ–π –Ω–∞ —á–∞—Å—Ç–∏"""
        try:
            # –†–∞–∑–±–∏–≤–∞–µ–º –¥–ª–∏–Ω–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è
            if len(response) > MAX_MESSAGE_LENGTH:
                chunks = self._split_message(response)
                for i, chunk in enumerate(chunks):
                    if i == 0:
                        await update.message.reply_text(chunk, parse_mode='Markdown')
                    else:
                        await update.message.reply_text(chunk, parse_mode='Markdown')
            else:
                await update.message.reply_text(response, parse_mode='Markdown')
                
        except Exception as e:
            # –ï—Å–ª–∏ –Ω–µ —É–¥–∞–ª–æ—Å—å –æ—Ç–ø—Ä–∞–≤–∏—Ç—å —Å Markdown, –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º –±–µ–∑ –Ω–µ–≥–æ
            try:
                await update.message.reply_text(response)
            except Exception as e2:
                await update.message.reply_text(f"‚ùå –û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏: {str(e2)}")

    def _split_message(self, message: str, max_length: int = MAX_MESSAGE_LENGTH) -> list:
        """–†–∞–∑–±–∏–≤–∞–µ—Ç –¥–ª–∏–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –Ω–∞ —á–∞—Å—Ç–∏"""
        chunks = []
        current_chunk = ""
        
        # –†–∞–∑–±–∏–≤–∞–µ–º –ø–æ —Å—Ç—Ä–æ–∫–∞–º
        lines = message.split('\n')
        
        for line in lines:
            if len(current_chunk) + len(line) + 1 <= max_length:
                current_chunk += line + '\n'
            else:
                if current_chunk:
                    chunks.append(current_chunk.strip())
                current_chunk = line + '\n'
        
        if current_chunk:
            chunks.append(current_chunk.strip())
        
        return chunks

    def _convert_to_html(self, text: str) -> str:
        """–ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ—Ç Markdown –≤ HTML –¥–ª—è Telegram"""
        # –ü—Ä–æ—Å—Ç—ã–µ –∑–∞–º–µ–Ω—ã
        text = text.replace('**', '<b>').replace('**', '</b>')
        text = text.replace('*', '<i>').replace('*', '</i>')
        text = text.replace('`', '<code>').replace('`', '</code>')
        
        # –û–±—Ä–∞–±–æ—Ç–∫–∞ –±–ª–æ–∫–æ–≤ –∫–æ–¥–∞
        text = re.sub(r'```(\w+)?\n(.*?)```', r'<pre><code>\2</code></pre>', text, flags=re.DOTALL)
        
        return text

    def run(self):
        """–ó–∞–ø—É—Å–∫–∞–µ—Ç –±–æ—Ç–∞"""
        # –°–æ–∑–¥–∞–µ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
        application = Application.builder().token(TELEGRAM_TOKEN).build()
        
        # –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏
        application.add_handler(CommandHandler("start", self.start))
        application.add_handler(CommandHandler("help", self.help_command))
        
        # –û–±—Ä–∞–±–æ—Ç—á–∏–∫ inline –∫–Ω–æ–ø–æ–∫
        application.add_handler(CallbackQueryHandler(self.button_callback))
        
        # –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –≤—Å–µ—Ö —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π
        application.add_handler(MessageHandler(filters.TEXT & ~filters.COMMAND, self.handle_message))
        
        # –ó–∞–ø—É—Å–∫–∞–µ–º –±–æ—Ç–∞
        print("üöÄ –ó–∞–ø—É—Å–∫ DeepSeek –±–æ—Ç–∞ —Å —Ñ–∏–ª–æ—Å–æ—Ñ—Å–∫–∏–º–∏ –º–∞—Ç–∞–º–∏ –∏ —á–µ—Ä–Ω—ã–º —é–º–æ—Ä–æ–º...")
        print("üåü –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è OpenRouter API")
        print("ü§ñ DeepSeek Coder –¥–æ—Å—Ç—É–ø–µ–Ω!")
        print("üíÄ –¶–∏–Ω–∏—á–Ω—ã–µ –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏—è —Å —Ñ–∏–ª–æ—Å–æ—Ñ—Å–∫–∏–º–∏ –º–∞—Ç–∞–º–∏ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω—ã!")
        print("üñï –ü–æ–¥—ä–µ–±—ã —Å —Ñ–∏–ª–æ—Å–æ—Ñ—Å–∫–∏–º –ø–æ–¥—Ç–µ–∫—Å—Ç–æ–º –≤–∫–ª—é—á–µ–Ω—ã!")
        print("üß† –ß–µ—Ä–Ω—ã–π —é–º–æ—Ä —Å –Ω–æ—Ç–∫–æ–π —Ñ–∏–ª–æ—Å–æ—Ñ–∏–∏ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω!")
        print("üé≠ –ô–û–£! –ë–æ—Ç –≥–æ—Ç–æ–≤ –∫ —Ä–∞–±–æ—Ç–µ, —Ñ–∏–ª–æ—Å–æ—Ñ-–Ω–µ—É–¥–∞—á–Ω–∏–∫!")
        
        application.run_polling()

if __name__ == "__main__":
    bot = DeepSeekBot()
    bot.run()
